<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <link rel="stylesheet" href="styles.css" />
  <title th:text="|${title}|">Title</title>
</head>
<body>

    <span id="header" th:text="|${title}|"></span>
    <span id="footer">Generated by <a href="https://github.com/EdgewareRoad/TrivySummary" th:text="|TrivySummary ${trivySummaryVersion}|"></a></span>

    <h1 th:text="|${title}|">Title</h1>

    <p th:text="|Report date is ${stringUtils.displayTodaysDate()}|">Report date is ...</p>
    <p th:if="${offlineMode}" th:text="|Trivy scans spanning ${stringUtils.displayDate(fromDate)} to ${stringUtils.displayDate(toDate)}.|">Today is ...</p>
    <p th:if="${!offlineMode && useTodayForEPSSQuery}" th:text="|Trivy scans spanning ${stringUtils.displayDate(fromDate)} to ${stringUtils.displayDate(toDate)}. EPSS scores for ${stringUtils.displayTodaysDate()}.|">Today is ...</p>
    <p th:if="${!offlineMode && !useTodayForEPSSQuery}" th:text="|Trivy scans spanning ${stringUtils.displayDate(fromDate)} to ${stringUtils.displayDate(toDate)}. EPSS scores for ${stringUtils.displayDate(toDate)}.|">Today is ...</p>
    <p th:if="${earlierArtefactName == laterArtefactName}">Artefact scanned is <b><span th:text="${earlierArtefactName}" /></b> of type <b><span th:text="${artefactType}" /></b></p>
    <p th:if="${earlierArtefactName != laterArtefactName}">Artefacts scanned are <b><span th:text="${earlierArtefactName}" /></b> to <b><span th:text="${laterArtefactName}" /></b> of type <b><span th:text="${artefactType}" /></b></p>
    <p th:if="${comparisonMayNotBeForSameArtefact}">
        <b>WARNING: </b>Artefact names do not indicate these are scans of the same component - comparison may not be valid</p>
    </p>
    <p th:if="${whitelistedVulnerabilities.hasUnapprovedEntries() || whitelistedVulnerabilities.hasEntriesRequiringReview()}">
        <b>WARNING: </b>Some <a href="#whitelistedVulnerabilities">whitelisted vulnerabilities</a> require review and/or approval.
    </p>
    <p th:if="${statusMessage != null}">
        <b th:if="${statusIsWarning == true}">WARNING: </b><b th:if="${statusIsWarning == false}">INFO: </b><span th:text="${statusMessage}"/>
    </p>

    <p>
        <ul>
            <li><a href="#openVulnerabilities">Open vulnerabilities</a></li>
            <li><a href="#whitelistedVulnerabilities">Whitelisted vulnerabilities</a></li>
            <li><a href="#closedVulnerabilities">Closed vulnerabilities</a></li>
            <li><a href="#configuration">Report configuration</a></li>
        </ul>
    </p>

    <a id="openVulnerabilities"></a>
    <h2>Open vulnerabilities</h2>

    <table class="pagebreakafter" th:with="priorities = ${ { { 'CRITICAL', 'vulnPriorityCritical' }, { 'HIGH', 'vulnPriorityHigh' }, { 'MEDIUM', 'vulnPriorityMedium' }, { 'LOW', 'vulnPriorityLow' } } }">
        <tr>
            <td th:each="priority : ${priorities}" th:if="${openVulnerabilities.getVulnerabilitiesAtPriority(priority[0]).size()} != null" th:class="|${priority[1]} priorityCountBox|">
                <table>
                    <tr>
                        <td class="vulnPriority" th:text="${priority[0]}">???</td>
                        <td class="priorityCount" th:text="${openVulnerabilities.getVulnerabilitiesAtPriority(priority[0]).size()}">???</td>
                    </tr>
                </table>
                <div th:if="${openVulnerabilities.getVulnerabilitiesAtPriority(priority[0]).size() > 0}">
                    <table>
                        <tr>
                            <td class="priorityCountFixable"><span th:text="|${openVulnerabilities.getVulnerabilitiesAtPriority(priority[0], true).size()} with |">???</span><a class="fixDisclaimerLink" href="#fixDisclaimer">fixes</a> available</td>
                        </tr>
                    </table>
                </div>
            </td>
        </tr>
    </table>

    <p th:if="${svgGraph != ''}" class="pagebreakafter" th:utext="${svgGraph}"></p>

    <table class="mainTableVulnerabilities pagebreakafter">
        <caption>
            Open vulnerabilities - Details<br/>New vulnerabilities in this scan marked with <span class="newVulnerabilityMarker">&nbsp;NEW&nbsp;</span>
        </caption>
        <thead class="mainTableHeader" >
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Priority</th>
                <th scope="col">Title</th>
                <th scope="col">Packages affected</th>
            </tr>
        </thead>
        <tbody class="mainTableBody" >
            <tr class="mainTableBodyRow" th:if="${openVulnerabilities.empty}">
                <td colspan="4"> No vulnerabilities </td>
            </tr>
            <tr class="mainTableBodyRow" th:each="vulnerability : ${openVulnerabilities.sorted}" th:with="priorities = ${ { { 'CRITICAL', 'vulnPriorityCritical' }, { 'HIGH', 'vulnPriorityHigh' }, { 'MEDIUM', 'vulnPriorityMedium' }, { 'LOW', 'vulnPriorityLow' } } }">
                <td><a th:href="${vulnerability.primaryURL}" th:text="${vulnerability.vulnerabilityID}" href="http://google.co.uk"> CVE id </a>
                    <span th:if="${vulnerability.nvdReference} != null"> <a class="secondaryRef" th:href="${vulnerability.nvdReference}">NVD</a></span>
                    <span th:if="${vulnerability.redhatReference} != null"> <a class="secondaryRef" th:href="${vulnerability.redhatReference}">RedHat</a></span>
                    <p th:if="${vulnerability.wasInPreviousScan == false}" class="newVulnerabilityMarker">&nbsp;NEW&nbsp;</p>
                </td>
                <td th:class="|vulnPriority${stringUtils.toUpperCamelCase(vulnerability.priority.name())}|"><span class="vulnPriority" th:text="${vulnerability.priority.name()}"/><p><span class="vulnScore" th:text="|Vendor Severity: ${vulnerability.vendorSeverity.name()}|"/><br class="vulnScore" /><span class="vulnScore" th:text="|CVSS: ${vulnerability.cvssScore}|"/><br class="vulnScore" /><span class="vulnScore" th:if="${vulnerability.epssScore} != null" th:text="|EPSS: ${stringUtils.displayDouble(vulnerability.epssScore)}|"/></p></td>
                <td><span th:text="${stringUtils.getHyphenated(vulnerability.title)}">This is the vulnerability title</span></td>
                <td>
                    <table class="subTablePackageVulnerabilities">
                        <thead class="subTableHeader" >
                            <tr>
                                <th>Package</th>
                                <th>Installed version</th>
                                <th>Fixed in version(s)</th>
                            </tr>
                        </thead>
                        <tbody class="subTableBody" >
                            <tr th:each="packageVuln : ${vulnerability.packageVulnerabilities}">
                                <td><span th:text="${stringUtils.getHyphenated(packageVuln.pkgName)}">ABCD123</span></td>
                                <td><span th:text="${packageVuln.installedVersion}">vXXXX</span></td>
                                <td><a th:text="${stringUtils.textWithDefaultOnNullOrEmpty(packageVuln.fixedVersion, 'No fixed package available')}" href="#fixDisclaimer">vYYYY</a></td>
                            </tr>
                        </tbody>
                    </table>
                </td>
            </tr>
        </tbody>
    </table>

    <a id="whitelistedVulnerabilities"></a>
    <h2>Whitelisted vulnerabilities</h2>

    <table class="whitelistTableVulnerabilities pagebreakafter">
        <thead class="whitelistTableHeader" >
            <tr>
                <th scope="col"> ID </th>
                <th scope="col"> Priority </th>
                <th scope="col"> Title </th>
                <th scope="col"> Whitelisting Justification </th>
                <th scope="col"> Next Review </th>
                <th scope="col"> Approval </th>
            </tr>
        </thead>
        <tbody class="whitelistTableBody pagebreakafter" >
            <tr class="whitelistTableBodyRow" th:if="${whitelistedVulnerabilities.empty}">
                <td colspan="6"> No whitelisted vulnerabilities present </td>
            </tr>
            <tr class="whitelistTableBodyRow" th:each="vulnerability : ${whitelistedVulnerabilities.sorted}">
                <td><a th:href="${vulnerability.primaryURL}" th:text="${vulnerability.vulnerabilityID}" href="http://google.co.uk"> CVE id </a>
                    <span th:if="${vulnerability.nvdReference} != null"> <a class="secondaryRef" th:href="${vulnerability.nvdReference}">NVD</a></span>
                    <span th:if="${vulnerability.redhatReference} != null"> <a class="secondaryRef" th:href="${vulnerability.redhatReference}">RedHat</a></span>
                </td>
                <td th:class="|vulnPriority${stringUtils.toUpperCamelCase(vulnerability.priority.name())}|"><span class="vulnPriority" th:text="${vulnerability.priority.name()}"/><p><span class="vulnScore" th:text="|Vendor Severity: ${vulnerability.vendorSeverity.name()}|"/><br class="vulnScore" /><span class="vulnScore" th:text="|CVSS: ${vulnerability.cvssScore}|"/><br class="vulnScore" /><span class="vulnScore" th:if="${vulnerability.epssScore} != null" th:text="|EPSS: ${stringUtils.displayDouble(vulnerability.epssScore)}|"/></p></td>
                <td><span th:text="${stringUtils.getHyphenated(vulnerability.title)}">This is the vulnerability title</span></td>
                <td><span th:text="${stringUtils.getHyphenated(vulnerability.whitelistingReason)}">This is the whitelisting justification</span></td>
                <td th:if="${vulnerability.requiresReview()}"><b>OVERDUE</b></td>
                <td th:if="${!vulnerability.requiresReview()}"><span th:text="${vulnerability.nextReviewDate}">Review date</span></td>
                <td th:if="${!vulnerability.isApproved()}"><b>REQUIRES APPROVAL</b></td>
                <td th:if="${vulnerability.isApproved()}"><span th:text="${stringUtils.getHyphenated(vulnerability.approvedBy)}">Approver</span><br/><span th:text="${vulnerability.approvalDate}">Approval date</span></td>
            </tr>
        </tbody>
    </table>

    <a id="closedVulnerabilities"></a>
    <h2>Closed vulnerabilities</h2>

    <p>
        <table th:with="priorities = ${ { { 'CRITICAL', 'vulnPriorityCritical' }, { 'HIGH', 'vulnPriorityHigh' }, { 'MEDIUM', 'vulnPriorityMedium' }, { 'LOW', 'vulnPriorityLow' } } }">
            <tr>
                <td th:each="priority : ${priorities}" th:if="${closedVulnerabilities.getVulnerabilitiesAtPriority(priority[0]).size()} != null" th:class="|${priority[1]} priorityCountBox|">
                        <span class="vulnPriority" th:text="${priority[0]}"></span>
                        <br/>
                        <span class="priorityCount" th:text="${closedVulnerabilities.getVulnerabilitiesAtPriority(priority[0]).size()}">???</span>
                </td>
            </tr>
        </table>
    </p>

    <table class="mainTableClosedVulnerabilities pagebreakafter">
        <caption>
            Closed vulnerabilities - Details
        </caption>
        <thead class="mainTableHeader" >
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Priority</th>
                <th scope="col">Title</th>
            </tr>
        </thead>
        <tbody class="mainTableBody" >
            <tr class="mainTableBodyRow" th:if="${closedVulnerabilities.empty}">
                <td colspan="4"> No vulnerabilities </td>
            </tr>
            <tr class="mainTableBodyRow" th:each="vulnerability : ${closedVulnerabilities.sorted}" th:with="priorities = ${ { { 'CRITICAL', 'vulnPriorityCritical' }, { 'HIGH', 'vulnPriorityHigh' }, { 'MEDIUM', 'vulnPriorityMedium' }, { 'LOW', 'vulnPriorityLow' } } }">
                <td><a th:href="${vulnerability.primaryURL}" th:text="${vulnerability.vulnerabilityID}" href="http://google.co.uk"> CVE id </a>
                    <span th:if="${vulnerability.nvdReference} != null"> <a class="secondaryRef" th:href="${vulnerability.nvdReference}">NVD</a></span>
                    <span th:if="${vulnerability.redhatReference} != null"> <a class="secondaryRef" th:href="${vulnerability.redhatReference}">RedHat</a></span>
                </td>
                <td th:class="|vulnPriority${stringUtils.toUpperCamelCase(vulnerability.priority.name())}|"><span class="vulnPriority" th:text="${vulnerability.priority.name()}"/><p><span class="vulnScore" th:text="|Vendor Severity: ${vulnerability.vendorSeverity.name()}|"/><br class="vulnScore" /><span class="vulnScore" th:text="|CVSS: ${vulnerability.cvssScore}|"/><br class="vulnScore" /><span class="vulnScore" th:if="${vulnerability.epssScore} != null" th:text="|EPSS: ${stringUtils.displayDouble(vulnerability.epssScore)}|"/></p></td>
                <td><span th:text="${stringUtils.getHyphenated(vulnerability.title)}">This is the vulnerability title</span></td>
            </tr>
        </tbody>
    </table>

    <a id="configuration"></a>
    <h2>Report configuration</h2>

    <p th:if="${isOffline}">Offline scan. No EPSS scores calculated. All priorities are calculated purely on the basis of vendor severity.</p>
    <p th:unless="${isOffline}"><span th:text="|EPSS scores loaded reflecting the ${useTodayForEPSSQuery ? 'date of this report' : 'date of the most recent scan'}. |"></span><span th:if="${priorityModel == null || priorityModel.getType().name() == 'SEVERITYONLY'}">All priorities are calculated purely on the basis of vendor severity.</span><span th:if="${priorityModel != null && priorityModel.getType().name() == 'RECTANGULAR'}">All priorities are calculated on a rectangular priority model.</span><span th:if="${priorityModel != null && priorityModel.getType().name() == 'ELLIPTICAL'}">All priorities are calculated on an elliptical priority model.</span>
    </p>
    <p th:if="${priorityModel != null && priorityModel.getType().name() != 'SEVERITYONLY'}"><span th:if="${priorityModel.criticalThresholds == null && priorityModel.highThresholds == null && priorityModel.mediumThresholds == null}"><b>WARNING: </b>No priority thresholds set in this priority model.</span><span th:unless="${priorityModel.criticalThresholds == null && priorityModel.highThresholds == null && priorityModel.mediumThresholds == null}">Thresholds for each priority:
            <ul>
                <li th:if="${priorityModel.criticalThresholds} != null" th:text="|CRITICAL: Minimum CVSS ${priorityModel.criticalThresholds.minimumCVSS}, Minimum EPSS ${priorityModel.criticalThresholds.minimumEPSS}|"></li>
                <li th:if="${priorityModel.highThresholds} != null" th:text="|HIGH: Minimum CVSS ${priorityModel.highThresholds.minimumCVSS}, Minimum EPSS ${priorityModel.highThresholds.minimumEPSS}|"></li>
                <li th:if="${priorityModel.mediumThresholds} != null" th:text="|MEDIUM: Minimum CVSS ${priorityModel.mediumThresholds.minimumCVSS}, Minimum EPSS ${priorityModel.mediumThresholds.minimumEPSS}|"></li>
            </ul>
        </span>
    </p>

    <a id="fixDisclaimer"></a>
    <h2>Fix Disclaimer</h2>
    <p>Please note that the term "fix" refers to the known availability of a patched version of the affected package for the platform, OS or product.  Moreover, where a fix is not yet marked as being available,
        this does not mean that the vulnerability / exposure should not be assessed as there may be other ways to remediate, such as upgrading the base OS / product on which the component is built, or rewriting
        the code to avoid use of the affected package.</p>
</body>
</html>