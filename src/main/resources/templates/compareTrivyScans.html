<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <link rel="stylesheet" href="styles.css" />
  <title th:text="|${title}|">Title</title>
</head>
<body>

    <span id="header" th:text="|${title}|"></span>
    <span id="footer">Generated by <a href="https://github.com/EdgewareRoad/TrivySummary" th:text="|TrivySummary ${trivySummaryVersion}|"></a></span>

    <h1 th:text="|${title}|">Title</h1>

    <p th:text="|Report date is ${new java.util.Date().toString()}|">Report date is ...</p>
    <p th:text="|Trivy scans spanning ${fromDate} to ${toDate}.|">Today is ...</p>
    <p th:if="${earlierArtefactName == laterArtefactName}">Artefact scanned is <b><span th:text="${earlierArtefactName}" /></b> of type <b><span th:text="${artefactType}" /></b></p>
    <p th:if="${earlierArtefactName != laterArtefactName}">Artefacts scanned are <b><span th:text="${earlierArtefactName}" /></b> to <b><span th:text="${laterArtefactName}" /></b> of type <b><span th:text="${artefactType}" /></b></p>
    <p th:if="${comparisonMayNotBeForSameArtefact}">
        <b>WARNING: </b>Artefact names do not indicate these are scans of the same component - comparison may not be valid</p>
    </p>
    <p th:if="${whitelistedVulnerabilities.hasUnapprovedEntries() || whitelistedVulnerabilities.hasEntriesRequiringReview()}">
        <b>WARNING: </b>Some <a href="#whitelistedVulnerabilities">whitelisted vulnerabilities</a> require review and/or approval.
    </p>
    <p th:if="${statusMessage != null}">
        <b th:if="${statusIsWarning == true}">WARNING: </b><b th:if="${statusIsWarning == false}">INFO: </b><span th:text="${statusMessage}"/>
    </p>

    <p>
        <ul>
            <li><a href="#openVulnerabilities">Open vulnerabilities</a></li>
            <li><a href="#whitelistedVulnerabilities">Whitelisted vulnerabilities</a></li>
            <li><a href="#closedVulnerabilities">Closed vulnerabilities</a></li>
        </ul>
    </p>

    <a id="openVulnerabilities"/>
    <h2>Open vulnerabilities</h2>

    <p th:if="${svgGraph != ''}" class="pagebreakafter" th:utext="${svgGraph}"></p>

    <p>
        <h3 th:if="${hasPriorityBands == true}">Higher Priority (More Severe and Exploitable) Vulnerabilities</h3>
        <table th:with="severities = ${ { { 'UNKNOWN', 'vulnSevCritical' }, { 'CRITICAL', 'vulnSevCritical' }, { 'HIGH', 'vulnSevHigh' }, { 'MEDIUM', 'vulnSevMedium' }, { 'LOW', 'vulnSevLow' } } }">
            <tr>
                <td th:each="severity : ${severities}" th:if="${openVulnerabilities.getCountOfVulnerabilitiesAtSeverity(severity[0], true)} != null" th:class="|${severity[1]} severityCountBox|">
                        <span th:text="${severity[0]}"></span>
                        <br/>
                        <span class="severityCount" th:text="${openVulnerabilities.getCountOfVulnerabilitiesAtSeverity(severity[0], true)}">???</span>
                </td>
            </tr>
        </table>
        <h3 th:if="${hasPriorityBands == true}">Lower Priority (Less Severe and/or Exploitable) Vulnerabilities</h3>
        <table th:if="${hasPriorityBands == true}" th:with="severities = ${ { { 'UNKNOWN', 'vulnSevUnknownNonPriority' }, { 'CRITICAL', 'vulnSevCriticalNonPriority' }, { 'HIGH', 'vulnSevHighNonPriority' }, { 'MEDIUM', 'vulnSevMediumNonPriority' }, { 'LOW', 'vulnSevLowNonPriority' } } }">
            <tr>
                <td th:each="severity : ${severities}" th:if="${openVulnerabilities.getCountOfVulnerabilitiesAtSeverity(severity[0], false)} != null" th:class="|${severity[1]} severityCountBox|">
                        <span class="vulnSeverity" th:text="${severity[0]}"></span>
                        <br/>
                        <span class="severityCount" th:text="${openVulnerabilities.getCountOfVulnerabilitiesAtSeverity(severity[0], false)}">???</span>
                </td>
            </tr>
        </table>
    </p>

    <table class="mainTableVulnerabilities pagebreakafter">
        <caption>
            Open vulnerabilities - Details<br/>New vulnerabilities in this scan marked with <span class="newVulnerabilityMarker">&nbsp;NEW&nbsp;</span>
        </caption>
        <thead class="mainTableHeader" >
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Severity</th>
                <th scope="col">Title</th>
                <th scope="col">Packages affected</th>
            </tr>
        </thead>
        <tbody class="mainTableBody" >
            <tr class="mainTableBodyRow" th:if="${openVulnerabilities.vulnerabilities.empty}">
                <td colspan="4"> No vulnerabilities </td>
            </tr>
            <tr class="mainTableBodyRow" th:each="vulnerability : ${openVulnerabilities.vulnerabilities.sorted}" th:with="severities = ${ { { 'UNKNOWN', 'vulnSevUnknown' }, { 'CRITICAL', 'vulnSevCritical' }, { 'HIGH', 'vulnSevHigh' }, { 'MEDIUM', 'vulnSevMedium' }, { 'LOW', 'vulnSevLow' } } }">
                <td><a th:href="${vulnerability.primaryURL}" th:text="${vulnerability.vulnerabilityID}" href="http://google.co.uk"> CVE id </a>
                    <span th:if="${vulnerability.nvdReference} != null"> <a class="secondaryRef" th:href="${vulnerability.nvdReference}">NVD</a></span>
                    <span th:if="${vulnerability.redhatReference} != null"> <a class="secondaryRef" th:href="${vulnerability.redhatReference}">RedHat</a></span>
                    <p th:if="${vulnerability.wasInPreviousScan == false}" class="newVulnerabilityMarker">&nbsp;NEW&nbsp;</p>
                    <p th:if="${vulnerability.isPriorityForRemediation == false}" class="secondaryRef">Lower priority - less severe and/or exploitable</p>
                </td>
                <td th:class="|vulnSev${stringUtils.toUpperCamelCase(vulnerability.severity.name())}${stringUtils.conditional(vulnerability.isPriorityForRemediation,'','NonPriority')}|"><span class="vulnSeverity" th:text="${vulnerability.severity.name()}"/><p><span class="vulnScore" th:text="|CVSS: ${vulnerability.cvssScore}|"/><br class="vulnScore" /><span class="vulnScore" th:if="${vulnerability.epssScore} != null" th:text="|EPSS: ${stringUtils.displayDouble(vulnerability.epssScore)}|"/></p></td>
                <td><span th:text="${stringUtils.getHyphenated(vulnerability.title)}">This is the vulnerability title</span></td>
                <td>
                    <table class="subTablePackageVulnerabilities">
                        <thead class="subTableHeader" >
                            <tr>
                                <th>Package</th>
                                <th>Installed version</th>
                                <th>Fixed in version(s)</th>
                            </tr>
                        </thead>
                        <tbody class="subTableBody" >
                            <tr th:each="packageVuln : ${vulnerability.packageVulnerabilities}">
                                <td><span th:text="${stringUtils.getHyphenated(packageVuln.pkgName)}">ABCD123</span></td>
                                <td><span th:text="${packageVuln.installedVersion}">vXXXX</span></td>
                                <td><span th:text="${packageVuln.fixedVersion}">vYYYY</span></td>
                            </tr>
                        </tbody>
                    </table>
                </td>
            </tr>
        </tbody>
    </table>

    <a id="whitelistedVulnerabilities"/>
    <h2>Whitelisted vulnerabilities</h2>

    <table class="whitelistTableVulnerabilities pagebreakafter">
        <thead class="whitelistTableHeader" >
            <tr>
                <th scope="col"> ID </th>
                <th scope="col"> Severity </th>
                <th scope="col"> Title </th>
                <th scope="col"> Whitelisting Justification </th>
                <th scope="col"> Next Review </th>
                <th scope="col"> Approval </th>
            </tr>
        </thead>
        <tbody class="whitelistTableBody" >
            <tr class="whitelistTableBodyRow" th:if="${whitelistedVulnerabilities.empty}">
                <td colspan="6"> No whitelisted vulnerabilities present </td>
            </tr>
            <tr class="whitelistTableBodyRow" th:each="vulnerability : ${whitelistedVulnerabilities}">
                <td><a th:href="${vulnerability.primaryURL}" th:text="${vulnerability.vulnerabilityID}" href="http://google.co.uk"> CVE id </a>
                    <span th:if="${vulnerability.nvdReference} != null"> <a class="secondaryRef" th:href="${vulnerability.nvdReference}">NVD</a></span>
                    <span th:if="${vulnerability.redhatReference} != null"> <a class="secondaryRef" th:href="${vulnerability.redhatReference}">RedHat</a></span>
                </td>
                <td th:class="|vulnSev${stringUtils.toUpperCamelCase(vulnerability.severity.name())}|"><span class="vulnSeverity" th:text="${vulnerability.severity.name()}"/></td>
                <td><span th:text="${stringUtils.getHyphenated(vulnerability.title)}">This is the vulnerability title</span></td>
                <td><span th:text="${stringUtils.getHyphenated(vulnerability.whitelistingReason)}">This is the whitelisting justification</span></td>
                <td th:if="${vulnerability.requiresReview()}"><b>OVERDUE</b></td>
                <td th:if="${!vulnerability.requiresReview()}"><span th:text="${vulnerability.nextReviewDate}">Review date</span></td>
                <td th:if="${!vulnerability.isApproved()}"><b>REQUIRES APPROVAL</b></td>
                <td th:if="${vulnerability.isApproved()}"><span th:text="${stringUtils.getHyphenated(vulnerability.approvedBy)}">Approver</span><br/><span th:text="${vulnerability.approvalDate}">Approval date</span></td>
            </tr>
        </tbody>
    </table>

    <a id="closedVulnerabilities"/>
    <h2>Closed vulnerabilities</h2>

    <p>
        <table th:with="severities = ${ { { 'UNKNOWN', 'vulnSevCritical' }, { 'CRITICAL', 'vulnSevCritical' }, { 'HIGH', 'vulnSevHigh' }, { 'MEDIUM', 'vulnSevMedium' }, { 'LOW', 'vulnSevLow' } } }">
            <tr>
                <td th:each="severity : ${severities}" th:if="${closedVulnerabilities.getCountOfVulnerabilitiesAtSeverity(severity[0])} != null" th:class="|${severity[1]} severityCountBox|">
                        <span th:text="${severity[0]}"></span>
                        <br/>
                        <span class="severityCount" th:text="${closedVulnerabilities.getCountOfVulnerabilitiesAtSeverity(severity[0])}">???</span>
                </td>
            </tr>
        </table>
    </p>

    <table class="mainTableClosedVulnerabilities">
        <caption>
            Closed vulnerabilities - Details
        </caption>
        <thead class="mainTableHeader" >
            <tr>
                <th scope="col"> ID </th>
                <th scope="col"> Severity </th>
                <th scope="col"> Title </th>
            </tr>
        </thead>
        <tbody class="mainTableBody" >
            <tr class="mainTableBodyRow" th:if="${closedVulnerabilities.vulnerabilities.empty}">
                <td colspan="4"> No vulnerabilities closed between Trivy scans </td>
            </tr>
            <tr class="mainTableBodyRow" th:each="vulnerability : ${closedVulnerabilities.vulnerabilities.sorted}">
                <td><a th:href="${vulnerability.primaryURL}" th:text="${vulnerability.vulnerabilityID}" href="http://google.co.uk"> CVE id </a>
                    <span th:if="${vulnerability.nvdReference} != null"> <a class="secondaryRef" th:href="${vulnerability.nvdReference}">NVD</a></span>
                    <span th:if="${vulnerability.redhatReference} != null"> <a class="secondaryRef" th:href="${vulnerability.redhatReference}">RedHat</a></span>
                </td>
                <td th:class="|vulnSev${stringUtils.toUpperCamelCase(vulnerability.severity.name())}|"><span class="vulnSeverity" th:text="${vulnerability.severity.name()}"/></td>
                <td><span th:text="${stringUtils.getHyphenated(vulnerability.title)}">This is the vulnerability title</span></td>
            </tr>
        </tbody>
    </table>

</body>
</html>